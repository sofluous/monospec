<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MonoSpec // Object Archive</title>
    <style>
        :root {
            --bg: #0a0f0a;
            --hud: #86f7a2;
            --hud-dim: #3bbf73;
            --hud-faint: #1f6b43;
            --accent: #e3ff7a;
            --warn: #f7c986;
            --card-bg: #0a130d;
            --grid: rgba(134, 247, 162, 0.06);
            --scan: rgba(134, 247, 162, 0.04);
            --shadow: rgba(0, 0, 0, 0.5);
            --font-ui: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--hud);
            font-family: var(--font-ui);
            line-height: 1.4;
            letter-spacing: 0.03em;
            overflow: hidden;
        }

        a {
            color: var(--accent);
            text-decoration: none;
        }

        .app {
            display: grid;
            grid-template-columns: 360px 1fr;
            grid-template-rows: 52px 1fr 32px;
            grid-template-areas: "topbar topbar" "nav    stage" "status status";
            height: 100vh;
        }

        .topbar {
            grid-area: topbar;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-bottom: 1px solid var(--hud-faint);
            background: linear-gradient(180deg, rgba(134, 247, 162, 0.06), rgba(134, 247, 162, 0.0));
            position: relative;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.12em;
        }

        .brand {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .brand .dot {
            width: 10px;
            height: 10px;
            border: 2px solid var(--hud);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--hud);
        }

        .brand .title {
            font-size: 14px;
        }

        .controls {
            font-size: 12px;
            color: var(--hud-dim);
            display: flex;
            gap: 16px;
        }

        .nav {
            grid-area: nav;
            border-right: 1px solid var(--hud-faint);
            padding: 8px;
            display: grid;
            grid-template-rows: auto auto 1fr;
            gap: 8px;
            background: repeating-linear-gradient(180deg, rgba(134, 247, 162, 0.03) 0px, rgba(134, 247, 162, 0.03) 1px, transparent 1px, transparent 8px);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tab {
            padding: 6px 10px;
            border: 1px solid var(--hud-faint);
            background: var(--card-bg);
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
            user-select: none;
            letter-spacing: .08em;
        }

        .tab.active {
            outline: 2px solid var(--hud-faint);
            background: rgba(134, 247, 162, 0.06);
        }

        .filter-bar {
            display: flex;
            gap: 6px;
            align-items: center;
            padding: 6px;
            border: 1px solid var(--hud-faint);
            background: var(--card-bg);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2) inset;
        }

        .filter-bar input {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            color: var(--hud);
            font: inherit;
            letter-spacing: 0.06em;
        }

        .list {
            overflow: auto;
            border: 1px solid var(--hud-faint);
            background: var(--card-bg);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.25) inset;
        }

        .list::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .list::-webkit-scrollbar-thumb {
            background: var(--hud-faint);
        }

        .list-item {
            display: grid;
            grid-template-columns: 64px 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 10px 8px;
            border-bottom: 1px solid var(--hud-faint);
            cursor: pointer;
            user-select: none;
            transition: background 120ms ease;
        }

        .list-item:hover {
            background: rgba(134, 247, 162, 0.06);
        }

        .list-item.active {
            background: rgba(134, 247, 162, 0.10);
            box-shadow: inset 0 0 0 1px var(--hud-faint);
        }

        .thumb {
            width: 64px;
            height: 48px;
            object-fit: contain;
            image-rendering: pixelated;
            filter: contrast(1.05) saturate(0.9) drop-shadow(0 3px 6px var(--shadow));
            pointer-events: none;
        }

        .meta {
            display: grid;
            line-height: 1.2;
        }

        .meta .name {
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
        }

        .meta .id {
            font-size: 11px;
            color: var(--hud-dim);
        }

        .meta .tags {
            font-size: 10px;
            color: var(--hud-dim);
            text-transform: uppercase;
        }

        .stage {
            grid-area: stage;
            position: relative;
            display: grid;
            grid-template-columns: 1.15fr 1fr;
            gap: 12px;
            padding: 12px;
            background: linear-gradient(180deg, rgba(2, 20, 10, 0.8), rgba(2, 20, 10, 0.6)), radial-gradient(1200px 600px at 70% 10%, rgba(134, 247, 162, 0.06), rgba(134, 247, 162, 0.0));
        }

        .card {
            position: relative;
            border: 1px solid var(--hud-faint);
            background: var(--card-bg);
            box-shadow: 0 8px 24px var(--shadow), inset 0 0 0 2px rgba(0, 0, 0, 0.35);
            min-height: 300px;
            overflow: hidden;
        }

        .card .heading {
            padding: 8px 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            border-bottom: 1px solid var(--hud-faint);
            background: linear-gradient(180deg, rgba(134, 247, 162, 0.08), rgba(134, 247, 162, 0.0));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .heading .blink {
            animation: blink 1.4s steps(2, jump-none) infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0.35;
            }
        }

        .viewer {
            position: relative;
            height: calc(100% - 40px);
            display: grid;
            place-items: center;
            padding: 14px;
            overflow: hidden;
        }

        .viewer .plane {
            position: relative;
            width: 100%;
            height: 100%;
            display: grid;
            place-items: center;
            background: linear-gradient(180deg, transparent, rgba(134, 247, 162, 0.05) 70%, transparent), radial-gradient(600px 200px at 50% 85%, rgba(134, 247, 162, 0.08), transparent);
            border: 1px dashed var(--hud-faint);
            outline: 6px solid rgba(0, 0, 0, 0.25);
            outline-offset: -6px;
            overflow: hidden;
            isolation: isolate;
        }

        .viewer video,
        .viewer img {
            max-width: 90%;
            max-height: 90%;
            image-rendering: pixelated;
        }

        .viewer canvas {
            max-width: 90%;
            max-height: 90%;
        }

        .viewer .scanlines::after {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(180deg, var(--scan) 1px, transparent 3px), repeating-linear-gradient(180deg, transparent 0, transparent 2px, rgba(0, 0, 0, 0.15) 2px, rgba(0, 0, 0, 0.15) 3px);
            mix-blend-mode: screen;
        }

        .viewer .vignette::after {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(120% 80% at 50% 50%, transparent, rgba(0, 0, 0, 0.55));
        }

        .details {
            display: grid;
            grid-template-rows: auto 1fr;
        }

        .detail-body {
            padding: 10px 12px;
            overflow: auto;
            height: calc(100% - 40px);
        }

        .kv {
            display: grid;
            grid-template-columns: 140px 1fr;
            gap: 6px 12px;
            margin-bottom: 10px;
        }

        .kv .k {
            color: var(--hud-dim);
            text-transform: uppercase;
            font-size: 11px;
        }

        .kv .v {
            font-size: 12px;
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0 2px;
        }

        .chip {
            border: 1px solid var(--hud-faint);
            padding: 3px 6px;
            font-size: 10px;
            text-transform: uppercase;
            color: var(--accent);
            background: rgba(134, 247, 162, 0.06);
        }

        .specs {
            border-top: 1px dashed var(--hud-faint);
            margin-top: 10px;
            padding-top: 10px;
        }

        .specs dl {
            display: grid;
            grid-template-columns: 190px 1fr;
            gap: 6px 12px;
        }

        .specs dt {
            color: var(--hud-dim);
            font-size: 11px;
            text-transform: uppercase;
        }

        .specs dd {
            margin: 0;
            font-size: 12px;
        }

        .status {
            grid-area: status;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 6px 10px;
            border-top: 1px solid var(--hud-faint);
            background: linear-gradient(0deg, rgba(134, 247, 162, 0.06), rgba(134, 247, 162, 0.0));
            font-size: 12px;
            color: var(--hud-dim);
        }

        .led {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--hud-dim);
            box-shadow: 0 0 6px var(--hud-dim);
        }

        .ca {
            text-shadow: 1px 0 rgba(227, 255, 122, 0.3), -1px 0 rgba(35, 255, 160, 0.2);
        }

        .muted {
            color: var(--hud-dim);
        }

        .mono {
            font-family: var(--font-ui);
        }

        @media (max-width: 1080px) {
            .app {
                grid-template-columns: 280px 1fr;
            }

            .stage {
                grid-template-columns: 1fr;
                grid-auto-rows: minmax(300px, 48vh) minmax(220px, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <header class="topbar">
            <div class="brand"><span class="dot"></span><span class="title ca">MONOSPEC // OBJECT ARCHIVE</span></div>
            <div class="controls"><span>↑/↓ Select</span><span>⏎ Play/Pause</span><span>F Fullscreen</span><span>Type to
                    Filter</span></div>
        </header>

        <aside class="nav">
            <div id="tabs" class="tabs" role="tablist" aria-label="Collections"></div>
            <div class="filter-bar"><span class="muted">FILTER</span><input id="filterInput"
                    placeholder="name / tag / id" autocomplete="off" /></div>
            <div id="list" class="list" role="listbox" aria-label="Object list"></div>
        </aside>

        <main class="stage">
            <section class="card" id="assetCard">
                <div class="heading ca">VISUAL // <span class="muted">ROTATION FEED</span> <span class="blink">▮</span>
                </div>
                <div class="viewer">
                    <div class="plane scanlines vignette" id="assetPlane" aria-live="polite"
                        aria-label="Selected asset visual"></div>
                </div>
            </section>

            <section class="card details" id="detailCard">
                <div class="heading ca">BRIEFING // <span class="muted">OBJECT INTEL</span></div>
                <div class="detail-body" id="detailBody">
                    <div class="kv">
                        <div class="k">Status</div>
                        <div class="v">No selection.</div>
                        <div class="k">Hint</div>
                        <div class="v">Use ↑/↓ to navigate, ⏎ to play/pause.</div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="status">
            <div class="led" id="led"></div>
            <div id="statusText">IDLE</div>
            <div class="muted">COLLECTIONS: <span id="collectionCount">0</span></div>
            <div class="muted">ITEMS: <span id="profileCount">0</span></div>
        </footer>
    </div>

    <script>
        // MonoSpec v0.2 — Phase 2: External data + collections/tabs
        // --------------------------------------------------
        // DATA LOADING
        // --------------------------------------------------
        // Expected external file: monospec-data.json
        // Shape: { collections: [{ id, name, items: [...] }] }
        // Each item matches the old schema { id, name, tags, thumb, asset:{type, ...}, description, details, specs }

        const SAMPLE_DATA = {
            collections: [
                {
                    id: 'handhelds', name: 'Handhelds',
                    items: [
                        {
                            id: 'R36S-GRN',
                            name: 'Anbernic R36S — Transparent Green',
                            thumb: 'https://upload.wikimedia.org/wikipedia/commons/3/3f/Placeholder_view_vector.svg',
                            tags: ['anbernic', 'r36s', 'rk3326', 'retro'],
                            asset: { type: 'webm', src: 'assets/sample-rotor.webm' },
                            description: 'Compact retro handheld with dual sticks and translucent shell.',
                            details: { Year: '2023', Chipset: 'RK3326', Display: '3.5" 640×480 IPS', OS: 'Linux' },
                            specs: { Dimensions: '145×74×20mm', Battery: '3200 mAh' }
                        }
                    ]
                },
                {
                    id: 'bags', name: 'Bags',
                    items: [
                        {
                            id: 'BAG-01', name: 'Shoulder Sling — Tech Grey',
                            thumb: 'https://upload.wikimedia.org/wikipedia/commons/3/3f/Placeholder_view_vector.svg',
                            tags: ['carry', 'daily'], asset: { type: 'img', src: 'assets/sample-bag.png' },
                            description: 'Compact EDC sling for handhelds and cables.',
                            details: { Capacity: '3L', Material: 'Ripstop' }, specs: { Compartments: '3' }
                        }
                    ]
                }
            ]
        };

        async function loadData() {
            try {
                const res = await fetch('monospec-data.json', { cache: 'no-store' });
                if (!res.ok) throw new Error('HTTP ' + res.status);
                const json = await res.json();
                validateData(json);
                return json;
            } catch (e) {
                console.warn('[MonoSpec] Falling back to SAMPLE_DATA:', e.message);
                validateData(SAMPLE_DATA);
                return SAMPLE_DATA;
            }
        }

        function validateData(data) {
            if (!data || !Array.isArray(data.collections)) throw new Error('Invalid data: missing collections');
            // quick duplicate id check across all items
            const ids = new Set();
            for (const col of data.collections) {
                if (!col.id) throw new Error('Collection missing id');
                for (const it of (col.items || [])) {
                    if (!it.id) throw new Error('Item missing id');
                    if (ids.has(it.id)) console.warn('[MonoSpec] Duplicate item id:', it.id);
                    ids.add(it.id);
                }
            }
        }

        // --------------------------------------------------
        // STATE
        // --------------------------------------------------
        const ui = {
            tabs: document.getElementById('tabs'),
            list: document.getElementById('list'),
            filter: document.getElementById('filterInput'),
            plane: document.getElementById('assetPlane'),
            details: document.getElementById('detailBody'),
            statusText: document.getElementById('statusText'),
            led: document.getElementById('led'),
            profileCount: document.getElementById('profileCount'),
            collectionCount: document.getElementById('collectionCount'),
        };

        const state = {
            data: null,
            currentCol: null,   // collection id
            filtered: [],       // items in current collection after filter
            index: 0,
        };

        function setStatus(text, good = false) {
            ui.statusText.textContent = text;
            ui.led.style.background = good ? 'var(--accent)' : 'var(--hud-dim)';
            ui.led.style.boxShadow = good ? '0 0 10px var(--accent)' : '0 0 6px var(--hud-dim)';
        }

        // --------------------------------------------------
        // RENDER: TABS (collections)
        // --------------------------------------------------
        function renderTabs() {
            ui.tabs.innerHTML = '';
            const cols = state.data.collections;
            ui.collectionCount.textContent = cols.length;
            cols.forEach(col => {
                const b = document.createElement('button');
                b.className = 'tab'; b.setAttribute('role', 'tab'); b.dataset.id = col.id; b.textContent = col.name;
                b.addEventListener('click', () => selectCollection(col.id));
                if (col.id === state.currentCol) b.classList.add('active');
                ui.tabs.appendChild(b);
            });
        }

        function selectCollection(id) {
            state.currentCol = id;
            renderTabs();
            applyFilter(ui.filter.value || '');
            setStatus('COLLECTION: ' + id, true);
        }

        // --------------------------------------------------
        // RENDER: LIST
        // --------------------------------------------------
        function renderList() {
            ui.list.innerHTML = '';
            for (let i = 0; i < state.filtered.length; i++) {
                const item = state.filtered[i];
                const row = document.createElement('div');
                row.className = 'list-item'; row.setAttribute('role', 'option'); row.dataset.index = i;
                row.innerHTML = `
          <img class="thumb" alt="${item.name} thumbnail" src="${item.thumb}" />
          <div class="meta">
            <div class="name">${item.name}</div>
            <div class="id">${item.id}</div>
            <div class="tags">${(item.tags || []).join(' • ')}</div>
          </div>
          <div class="muted">▶</div>`;
                row.addEventListener('click', () => selectIndex(i));
                ui.list.appendChild(row);
            }
            ui.profileCount.textContent = state.filtered.length;
            applyActiveRow();
        }

        function applyActiveRow() {
            document.querySelectorAll('.list-item').forEach((el, idx) => {
                el.classList.toggle('active', idx === state.index);
                if (idx === state.index) el.scrollIntoView({ block: 'nearest' });
            });
        }

        // --------------------------------------------------
        // RENDER: DETAILS
        // --------------------------------------------------
        function renderDetails(item) {
            const chips = (item.tags || []).map(t => `<span class="chip">${t}</span>`).join('');
            const detailKV = Object.entries(item.details || {}).map(([k, v]) => `<div class="k">${k}</div><div class="v">${v}</div>`).join('');
            const specsKV = Object.entries(item.specs || {}).map(([k, v]) => `<dt>${k}</dt><dd>${v}</dd>`).join('');
            ui.details.innerHTML = `
        <div class="kv"><div class="k">Object</div><div class="v"><strong>${item.name}</strong></div><div class="k">ID</div><div class="v">${item.id}</div></div>
        <div class="chips">${chips}</div>
        <p class="mono">${item.description || ''}</p>
        <div class="kv">${detailKV}</div>
        <div class="specs"><h4 class="muted" style="margin:0 0 6px 0; text-transform: uppercase;">Specs</h4><dl>${specsKV}</dl></div>`;
        }

        // --------------------------------------------------
        // RENDER: ASSET
        // --------------------------------------------------
        let currentPlayerCleanup = null;

        function renderAsset(item) {
            if (typeof currentPlayerCleanup === 'function') { currentPlayerCleanup(); currentPlayerCleanup = null; }
            ui.plane.innerHTML = '';

            const wrap = document.createElement('div');
            Object.assign(wrap.style, { position: 'relative', display: 'grid', placeItems: 'center', width: '100%', height: '100%' });

            const grid = document.createElement('div');
            Object.assign(grid.style, { position: 'absolute', inset: '0', background: `linear-gradient(transparent 95%, var(--grid) 95%), linear-gradient(90deg, transparent 95%, var(--grid) 95%)`, backgroundSize: '100% 20px, 20px 100%', zIndex: '0' });
            wrap.appendChild(grid);

            let playerEl = null; const t = (item.asset || {}).type;
            if (t === 'webm') {
                const v = document.createElement('video');
                v.src = item.asset.src; v.autoplay = true; v.loop = true; v.muted = true; v.playsInline = true; v.style.filter = 'drop-shadow(0 12px 24px var(--shadow))';
                playerEl = v; wrap.appendChild(v); currentPlayerCleanup = () => { v.pause(); v.src = ''; v.load(); };
            } else if (t === 'gif' || t === 'img') {
                const img = document.createElement('img'); img.src = item.asset.src; img.alt = item.name; img.style.filter = 'drop-shadow(0 12px 24px var(--shadow))'; playerEl = img; wrap.appendChild(img);
            } else if (t === 'pngseq') {
                const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                let frame = 0; const { base, count, fps = 12 } = item.asset; const images = new Array(count); let rafId = null; let last = performance.now();
                function pad(n, width = 4) { return String(n).padStart(width, '0'); }
                for (let i = 0; i < count; i++) { const im = new Image(); im.decoding = 'async'; im.loading = 'eager'; im.onload = () => { if (!canvas.width && im.width) { canvas.width = im.width; canvas.height = im.height; } }; im.src = `${base}${pad(i + 1)}.png`; images[i] = im; }
                function loop(ts) { const dt = ts - last; if (dt >= (1000 / fps)) { frame = (frame + 1) % count; last = ts; } ctx.clearRect(0, 0, canvas.width, canvas.height); const im = images[frame]; if (im && im.complete) ctx.drawImage(im, 0, 0); rafId = requestAnimationFrame(loop); }
                function start() { if (!rafId) rafId = requestAnimationFrame(loop); } function stop() { if (rafId) cancelAnimationFrame(rafId); rafId = null; }
                currentPlayerCleanup = () => { stop(); };
                playerEl = canvas; wrap.appendChild(canvas); start();
            } else { const fallback = document.createElement('div'); fallback.textContent = 'No asset configured.'; wrap.appendChild(fallback); }

            const hudTL = document.createElement('div'); hudTL.textContent = 'CAM: ROTOR FEED 01'; Object.assign(hudTL.style, { position: 'absolute', left: '8px', top: '8px', fontSize: '11px', color: 'var(--hud-dim)' });
            const hudBR = document.createElement('div'); hudBR.textContent = 'VIS CLR: ALPHA'; Object.assign(hudBR.style, { position: 'absolute', right: '8px', bottom: '8px', fontSize: '11px', color: 'var(--hud-dim)' });
            wrap.appendChild(hudTL); wrap.appendChild(hudBR); ui.plane.appendChild(wrap);

            ui.plane.onclick = () => { if (!playerEl) return; if (playerEl.tagName === 'VIDEO') { if (playerEl.paused) { playerEl.play(); setStatus('PLAY ▶', true); } else { playerEl.pause(); setStatus('PAUSE ▮▮'); } } };
        }

        // --------------------------------------------------
        // SELECTION & FILTER
        // --------------------------------------------------
        function getCurrentCollection() { return state.data.collections.find(c => c.id === state.currentCol) || state.data.collections[0]; }

        function selectIndex(idx) {
            if (state.filtered.length === 0) return;
            state.index = (idx + state.filtered.length) % state.filtered.length;
            const item = state.filtered[state.index];
            applyActiveRow(); renderAsset(item); renderDetails(item); setStatus(`SELECT ${item.id}`);
        }

        function applyFilter(q) {
            const s = (q || '').trim().toLowerCase();
            const col = getCurrentCollection();
            const arr = col.items || [];
            state.filtered = !s ? [...arr] : arr.filter(it => (
                (it.name || '').toLowerCase().includes(s) || (it.id || '').toLowerCase().includes(s) || (it.tags || []).some(t => (t || '').toLowerCase().includes(s))
            ));
            state.index = 0; renderList(); selectIndex(0);
        }

        // --------------------------------------------------
        // INPUTS
        // --------------------------------------------------
        window.addEventListener('keydown', (e) => {
            const tag = (e.target && e.target.tagName) || '';
            const inInput = tag === 'INPUT' || tag === 'TEXTAREA';
            if (!inInput) {
                if (e.key === 'ArrowDown') { e.preventDefault(); selectIndex(state.index + 1); }
                if (e.key === 'ArrowUp') { e.preventDefault(); selectIndex(state.index - 1); }
                if (e.key === 'Enter') { e.preventDefault(); document.getElementById('assetPlane').click(); }
                if (e.key.toLowerCase() === 'f') { toggleFullscreen(); }
            }
        });

        function toggleFullscreen() { const el = document.documentElement; if (!document.fullscreenElement) el.requestFullscreen().catch(() => { }); else document.exitFullscreen().catch(() => { }); }

        // --------------------------------------------------
        // INIT
        // --------------------------------------------------
        (async function init() {
            state.data = await loadData();
            state.currentCol = state.data.collections[0]?.id || null;
            renderTabs();
            ui.filter.addEventListener('input', (e) => applyFilter(e.target.value));
            applyFilter('');

            // Pause videos if viewer offscreen (saves CPU on long pages)
            const io = new IntersectionObserver((entries) => { entries.forEach(en => { if (en.target.id === 'assetCard') { const videos = en.target.querySelectorAll('video'); videos.forEach(v => en.isIntersecting ? v.play().catch(() => { }) : v.pause()); } }); }, { threshold: 0.1 });
            io.observe(document.getElementById('assetCard'));
        })();
    </script>
</body>

</html>
